<% if @student_monthly_grades.blank? %>
  alert("No grade of selected month range are present")
  location.reload(true); 
<% else %>
  $("#select_subject").multiselect('destroy');
  $('#select_subject').find('option').remove();

  <% @student_monthly_grades.map(&:subject_name).uniq.each do |subject|%>
    $("#select_subject").append($("<option value='<%= subject %>'><%= subject %></option>"));
  <% end %> 
  
  $("#select_subject").multiselect({
    onChange: function(element, checked) {
      $.post("/users/change_subjects",$("#select_subject_form").serialize());
    },
    includeSelectAllOption: true
  });
  
  drawChart(<%= raw @month_average%>, <%= raw @average_particular_student_of_current_grade %>);

  $('#change_date_range').replaceWith("<%= j render 'change_date_range'%>")
  
  <% unless params[:subject_selected].blank? %>
    $('#month_subject_list').remove()
    $('#change_month_form').append("<input type='hidden' name='subject_selected' id='month_subject_list' value='<%= params[:subject_selected]%>'>");
    <% params[:subject_selected].split(',').each do |subject| %>
      $("#select_subject").find("option[value='<%= subject %>']").prop("selected", "selected");
      $("#select_subject").multiselect('refresh');
    <% end %>
  <% end %>
    
  $('#student_detail').html("<b>Display data of student name - <%= @student.student_name%></b><br><b>From <%= select_default_start_month %> <%= set_selected_year %> To <%= select_default_end_month %> <%= set_selected_year %></b></br><b>School Name - <%= @student_school_status.school.name %></br><b>Grade Name - <%= @student_monthly_grades.first.grade_name+@student_monthly_grades.first.grade_class %></b>");
  
  $("#stu_input_year,#stu_input_start,#stu_input_end").remove();
  
  $('#select_student_form').append("<input type='hidden' name='year' id='stu_input_year' value="+<%=params[:date][:year]%>+">");
  $('#select_student_form').append("<input type='hidden' name='start' id='stu_input_start' value="+<%=Date::MONTHNAMES.index(params[:start_month])%>+">");
  $('#select_student_form').append("<input type='hidden' name='end' id='stu_input_end' value="+<%=Date::MONTHNAMES.index(params[:end_month])%>+">");

  $("#sub_input_year,#sub_input_start,#sub_input_end").remove();
  
  $('#select_subject_form').append("<input type='hidden' name='year' id='sub_input_year' value="+<%=params[:date][:year]%>+">");
  $('#select_subject_form').append("<input type='hidden' name='start' id='sub_input_start' value="+<%=Date::MONTHNAMES.index(params[:start_month])%>+">");
  $('#select_subject_form').append("<input type='hidden' name='end' id='sub_input_end' value="+<%=Date::MONTHNAMES.index(params[:end_month])%>+">");

  $('#show_average_and_noshow').replaceWith("<%= j render 'show_average_and_noshow'%>")
  
  var monthNames = [ "January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December" ];
  var start_month = monthNames.indexOf($('#start_month').find(":selected").val());
  var end_month = monthNames.indexOf($('#end_month').find(":selected").val());
  var i = end_month
  while( i >= 0 ){  
    $("#end_month option[value="+monthNames[i]+"]").prop("disabled",false);
    i--
  }
  i = 0
  while (i < start_month){
    $("#end_month option[value="+monthNames[i]+"]").prop("disabled","true");
    i++
  }  
<% end %>
